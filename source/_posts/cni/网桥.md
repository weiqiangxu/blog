---
title: 什么是网桥
index_img: /images/bg/k8s.webp
banner_img: /images/bg/5.jpg
tags:
  - kubernetes
categories:
  - kubernetes
date: 2023-06-05 18:40:12
excerpt: 理解什么是网桥、如何应用
sticky: 1
---

1. 网桥的创建

``` bash
# 安装 bridge-utils 包，它包含了配置网桥所需的工具
$ yum install bridge-utils

# 创建网桥
# sudo brctl addbr <bridge-name>
$ sudo brctl addbr my-net

# 将物理接口添加到网桥中
# sudo brctl addif <bridge-name> <physical-interface>
$ sudo brctl addif my-net lo

# 将名为 "my-net" 的网络接口（network interface）启用（up）
# sudo ip link set dev <bridge-name> up
$ ip link set dev my-net up

# ifconfig 可以查看到 my-net 网桥
# 查看网桥的状态以及连接到网桥上的接口
$ brctl show
```

2. 删除网桥

``` bash
# 查看网桥
$ brctl show

# 停止网桥
# ifconfig <bridge-name> down
$ ifconfig my-net down

# 删除网桥
# brctl delbr <bridge-name>
$ brctl delbr my-netm
```

### Q&A

##### 1.将网络接口(网卡)添加到网桥之中会怎么样

1. 将网卡加入网桥，该网卡可以接收和转发网桥中其他网络设备（包括其他网卡、虚拟机等）发送的数据包。
2. 该网卡也可以向网桥中的其他设备发送数据包，从而实现网络通信。
3. 通过使用网桥，可以在不同的网络设备之间进行透明的通信，就像它们直接相连一样.

> 同一个网桥的设备之间可以通信；

##### 2.sudo brctl addif my-net eth0 这句话什么意思，lo的流量会怎么走

- 将 "eth0" 的物理网络接口（network interface）添加到名为 "my-net" 的 Linux 桥接器（bridge）上。
- "eth0" 的网络流量转发到该桥接器上，以便与其他连接到该桥接器的设备进行通信。


##### 3.网络接口lo流量走向

- 系统上的本地回环接口（loopback interface）；
- 同一系统内部发送和接收数据包；
- lo的流量不会通过该桥接器或任何其他物理网络接口，直接在内核中传递，计算机内部进行循环传输；


### Q&A

- docker容器是net=none的，可以直接访问容器内部吗

   如果将容器的网络类型设置为net=none，那么容器将完全没有网络访问权限，无论是从容器内部访问外部网络，还是从外部网络访问容器内部的服务都不可能实现。

- docker的网络类型有哪些

   bridge或者host模式，默认使用的是bridge网络模，在bridge网络模式下，容器的IP地址是通过NAT(Network Address Translation，网络地址转换)进行转换的，所以从容器外部无法直接访问容器内部的IP地址。
   Docker daemon创建的docker0虚拟网桥，会为每个容器分配一个私有的IP地址。
   当容器需要与外部网络通信时，容器的私有IP地址会被NAT为宿主机的IP地址，并通过宿主机上的网络接口与外部网络通信。
   这样可以让多个容器共享一个宿主机的公网IP地址，从而节省公网IP地址的使用。

- Docker的NAT是什么

   NAT（Network Address Translation），将Docker容器中的私有IP地址（通常是172.17.x.x）映射到宿主机的公共IP地址上，实现容器和宿主机之间的通信了；
   NAT功能通过Linux内核的iptables实现；
   具体来说，当创建Docker容器时，Docker会在宿主机上创建一个虚拟网桥，容器会被连接到该虚拟网桥上。
   Docker会利用iptables将容器的私有IP地址和虚拟网桥的IP地址进行映射，并将对应的数据包转发到容器内部。
   当容器需要访问外部网络时，Docker会将容器发送的数据包进行NAT处理，将私有IP地址替换为宿主机的公共IP地址，以实现容器和外部网络之间的通信。

- docker的网络类型bridge和host有什么区别

1. Bridge网络类型是Docker默认的网络类型，而Host网络类型是指容器直接使用宿主机的网络，不会进行网络隔离。
2. Bridge网络类型在容器和宿主机之间建立虚拟网络，容器之间可以通过容器名或者IP地址相互通信，但是容器和宿主机之间需要映射端口才能通信。
3. Host网络类型直接使用宿主机的网络，容器可以直接访问宿主机的所有端口和网络设备，但是容器之间的网络隔离失效。
4. Bridge网络类型可以使用Docker内置的DNS服务来访问其他容器的服务，而Host网络类型需要使用宿主机的DNS服务来访问其他服务。
5. Bridge网络类型可以使用Docker内置的端口映射来将容器内部的端口映射到宿主机的端口，从而实现容器与外部的通信。而Host网络类型不需要进行端口映射，直接使用宿主机的端口即可。